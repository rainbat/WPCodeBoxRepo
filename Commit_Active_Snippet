"<?php \n\nfunction commitsnippet_admin_bar_button($wp_admin_bar){\n    $args = [\n        \"id\" => \"custom-button-commitsnippet\",\n        \"title\" => \"Commit Active Snippet\",\n        \"href\" => \"#\",\n        \"meta\" => [\n            \"class\" => \"custom-button-class\",\n            \"onclick\" => \"commitSnippet()\"\n        ]\n    ];\n    $wp_admin_bar->add_node($args);\n}\nadd_action(\"admin_bar_menu\", \"commitsnippet_admin_bar_button\", 100);\n\nfunction commitsnippet_script() {\n?>\n    <script type=\"text\/javascript\">\n        function commitSnippet(){\n            let snippet_post_id = jQuery(\".active\").attr(\"data-id\");\n            console.log( snippet_post_id );\n            if( snippet_post_id != \"\" ){\n                console.log( \"Admin Bar Script\" );\n                jQuery.ajax({\n                    dataType: 'text',\n                    url: 'admin-ajax.php',\n                    data: {\n                        action: 'exec_commitsnippet',\n                        snippet_id: snippet_post_id\n                    },\n                    success: function(data) {\n                        alert( \"Server: \" + data );\n                    }\n                });\n            }else{\n                alert( \"Probably no active Snippet\" );   \n            }\n        }\n    <\/script>\n<?php\n}\nadd_action( 'admin_footer', 'commitsnippet_script' );\n\nfunction exec_commitsnippet() {\n\tglobal $wpdb;\n    \n    $snippet_id = $_GET[\"snippet_id\"];\n    \n    $snippet_name_sql = \"select post_title as val from wp_posts where ID = '25878' \";\n    $snippet_name = $wpdb->get_results( $snippet_name_sql );\n    \/\/echo $snippet_name[\"0\"]->val; die();\n\n    $snippet_content_sql = \"select meta_value as val from wp_postmeta where post_id = '25878' and meta_key = 'wpcb_code' \";\n    $snippet_content = $wpdb->get_results( $snippet_content_sql );\n    \/\/echo $snippet_content[\"0\"]->val; die();\n\n    \/\/$filename = \"test.php\";\n    \/\/we just replace spaces with _ to determine filename (Neanderthal #1)\n    $filename = str_replace( \" \", \"_\", $snippet_name[\"0\"]->val );\n    $content = $snippet_content[0]->val;\n    \/\/echo $filename; die();\n    $reponame = \"WPCodeBoxRepo\";\n    \n    $username = \"rainbat\";\n    \/\/$password = \"riwtuj-Gycza4-pofryx\";\n    $nickname = \"Domi\";\n    $email = \"info@rainbat.ch\";\n    \n    \/\/ https:\/\/github.com\/settings\/tokens\n\t$token = \"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\";\n\t\n    $useragent = 'Mozilla\/5.0 (Windows NT 6.2; WOW64; rv:17.0) Gecko\/20100101 Firefox\/17.0';\n\n    \/\/ First get the File to get the sha\n\t$ch = curl_init();\n\tcurl_setopt($ch, CURLOPT_URL, \"https:\/\/api.github.com\/repos\/$username\/$reponame\/contents\/$filename\");\n\tcurl_setopt($ch, CURLOPT_USERPWD, \"$username:$token\" );\n    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\tcurl_setopt($ch, CURLOPT_USERAGENT, $useragent );\n    $response = curl_exec($ch);\n\t$responseCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n\t$response_json = json_decode($response);\n\t$response_json_pretty = json_encode( $response_json, JSON_PRETTY_PRINT );\n\t$response_file_content = base64_decode( $response_json->content );\n\t$response_file_hash = $response_json->sha;\n \tcurl_close($ch);\n \t\n \t\/\/Uncomment to see if we can find the file hash first\n \t\/\/echo \"previous sha \" . $response_file_hash; die();\n\t\n\tif( $response_file_hash == \"\" ){\n\t    echo \"Did not find previous Version, Token maybe expired.\";\n\t}\n\t\n\t\/\/ Post to this file hash\n\t$ch = curl_init();\n\t$comitter = [\n\t        \"name\" => \"$nickname\",\n\t        \"email\" => \"$email\"\n\t];\n\t$payload = [\n\t    \"message\" => \"Commited from PHP\",\n\t    \"path\" => \"$filename\",\n\t    \"repo\" => \"$reponame\",\n\t    \"owner\" => \"$username\",\n\t    \"committer\" => $comitter,\n\t    \"sha\" => $response_file_hash,\n\t    \"content\" => base64_encode( json_encode( $content ) )\n\t];\n\t$payload_json = json_encode( $payload, JSON_PRETTY_PRINT );\n    \/\/echo $payload_json; die();\n    \n\tcurl_setopt($ch, CURLOPT_URL, \"https:\/\/api.github.com\/repos\/$username\/$reponame\/contents\/$filename\");\n\tcurl_setopt($ch, CURLOPT_USERPWD, \"$username:$token\");\n    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\tcurl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application\/vnd.github.VERSION.raw']);\n\tcurl_setopt($ch, CURLOPT_USERAGENT, $useragent );\n\tcurl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT');\n\tcurl_setopt($ch, CURLOPT_POSTFIELDS, $payload_json );\n    $response = curl_exec($ch);\n    \/\/$responseCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);\n\t$response_json = json_decode($response);\n\tcurl_close($ch);\n\techo \"Commited \" . $response_json->content->name;\n    die();\n}\nadd_action( 'wp_ajax_exec_commitsnippet', 'exec_commitsnippet' );\n"